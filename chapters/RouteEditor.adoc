== Route Editor

=== Before Getting Started

_Some comments in case you just jumped right to to this section_

To start working with the Route Editor you need to:

* Have downloaded and run the TSRE5 application
* Have at least one train simulator *gameRoot* or *Root Directory* to refer to

[NOTE]
 A `gameRoot` must be one of the following items:

* An MSTS root directory
* An {OR} installation profile
* A Mini Route directory
* Any other Directory that contains populated "global", "routes" and "trains" folders 

=== Overview

* _(Optional)_ Set the `gameRoot` value in the application settings to your desired Root Directory. See: <<settings>>

* Open `TSRE5.exe`, or `TSRE5x32.exe` if you are using a 32 bit version of Windows

[IMAGE]
image::images/re1.png[]

If you have properly set up the `gameRoot` settings then the {RE} is ready to use.  


<<<<
[#begin]
=== Starting a Session

If you want to use the {RE}, simply open the TSRE5 application. By default, the *Route Editor* features will be available.  The *Activity Editor* is also available from within the {RE}.

[NOTE]
 If you want to use *Consist Editor*  however, you need to use the `ConsistEditor.bat` file to start a Consist Editing session.

[IMAGE]
image::images/intro3.png[]


=== Loading a Route

If you have not defined a default "gameRoot" setting, you will need to click the *browse* button and select your game directory every time that TSRE is loaded. It can be any directory that contains `Routes`, `Trains` and `Global` folders such as the standard MSTS installation folder, or a mini route folder.

[IMAGE]
image::images/lr1.png[]

You can also select from your "recently used" folders if you have had previous {RE} sessions.

[IMAGE]
image::images/lr2.png[]

Select the route you want to edit and click `Load`

[IMAGE]
image::images/lr3.png[]




<<<<
[#newroute]
=== Creating A New Route

Click the `New` button

[IMAGE]
image::images/ren1.png[]

Enter the name to use as a *Route Name ID*. This will become the route's directory name and is used for the naming of key files. It is a good practice to enter a short, lowercase name with no spaces.

Enter the Latitude and Longitude of the World coordinates where you want to start the new Route. If it will be a fictional route, you can use default values. 

[WARNING]
  The values entered need to be valid Latitude and Longitude coordinate values, otherwise {RE} will crash. 

[IMAGE]
image::images/ren2.png[]

To find the Latitude and Longitude of the location you want to work in, you can use Google Maps.

[IMAGE]
image::images/ren4.png[]

Click *OK* button.

You can now edit the Route Settings. You can also click *OK* here and come back to update these values later.

[IMAGE]
image::images/ren3.png[]

Display name:: The Route name. 
Description::  The Route description.

Electrified:: Yes/No option to choose if tracks have electricity.
Wire Height:: The overhead line height. 

[NOTE]
The default MSTS/{OR} wire is visually unpleasing and many route builders ignore this value.


Max Voltage:: The overhead line voltage.

Start Tile:: The {RE} will start at this world position. Changing these values is not recommended while creating new route.

[IMAGE]how to use
image::images/ren4.png[]

You can now begin editing your new route.

<<<<

=== Getting Around in the Route Editor

*Main Window*


[IMAGE]
image::images/rec1.png[]

[#menu]
==== Menu

`Route->Save`:: Save changes.
`Route->Create Paths`:: Delete all existing paths and create new simple paths for each track end node. You can use it to test route in OR without manually creating paths. If route has custom paths - make backup first!
`Route->Edit Route settings`:: edit route settings (TRK file) in new window.
`Route->Exit`:: Close the route editor.

`Edit->Copy`:: copy selected object (ctrl+c).
`Edit->Paste`:: paste selected object (ctrl+v).

`View`:: show/hide route objects.

`Tools->Properties`:: show/hide properties tab.
`Tools->NaviWindow`:: show/hide navigation window.
`Tools->F1 - Tools->F12`:: choose a tool-set to work with.

`Help->About`:: show app info.

==== Properties

Shows the selected object's properties.

==== Tools

Tools you can use to edit your route. The list adjusts to context.

==== Route View  
Shows the route visuals.


<<<

[#editor]
=== Using the Editor

`F1 ... F12`::    Choose a tool-set.
`Ctrl-Shift-S`::   Save the route
`B`::   Create new Tile at current position

[IMAGE]
image::images/rec4.png[]

==== General Navigation

===== Navigating Keys

`AWSD` (and *Arrows* if `UseNumPad=False in 'settings.txt'`)::  Move left, right, front, back.

* Min Speed is keyboard arrow keys + SHIFT key.
* Std Speed is keyboard arrow keys.
* Max Speed is keyboard arrow keys + CTRL key.

See Camera Speed Presets in <<settings>>

[TIP] 
 Press left mouse button and move mouse to look around.

<<<

===== Keyboard

[IMAGE]
image::images/rec3.png[]

Keyboard has two layouts depending on the setting in the `settings.txt` file.

1. If `useNumPad = true` TSRE assumes you have a number pad
2. If `useNumPad = false` TSRE assumes you will use the Arrow Keys

[TIP]
 Remember: `Ctrl + Z` will *Undo* the last operation

<<<

[#naviwindow]
=== Navi Window 

The Navi Window is a separate movable window that allows coarse adjustments of position with the {RE}. It can take input from Traditional Marker Files (MKR), Google Earth Keyhole Markup Language (KML) files and Open Street Map (GPX) files.

If desired, it will accept Latitude and Longitude values or any existing Route entities that have been defined. 

[IMAGE]
image::images/naviwindow.png[]

*Using Lat/Long, Marker files, GPS position files, or object placements in the Navi Window*

Example 1:: 
Select a file from the pull down list in the navi windows (You can use MKR, KML, GPX) and select item from the file for a location to go to. _See <<realistic>>_

Example 2::
The Navi Window will show the current world Lat/Long position. You can enter a specific Lat/Long position you want to go to 

Example 3:: Select a category from the categories list, like *Route: Sidings*. Select a *siding*.

When you have entered the desired position you wish to be moved to, Select `Jump` to go there.

[IMAGE]
image::images/rec2.png[]

[NOTE]
  The Navi Window will also show the current tile object count and removed object count. 

<<<

=== Working With Objects:

`Q`:: Place a new object.
`Ctrl + Q`:: Toggle the "manual/auto" `add track to TDB` option (use Z key for manual).
`Shift + Q`::  Change the placement mode: stick only to terrain / stick to everything.

[IMAGE]
image::images/rec5.png[]

==== Object Placement Keys

`E`:: Select

`R`:: Rotate
`T`:: Translate / Transform
`Y`:: Scale. Use for example with transfers, dynamic tracks
`X`:: Flip

`Ctrl`:: Change *R/T/Y* step slower.
`Alt`:: Change *R/T/Y* step faster.

`H`:: Adjust object position to terrain.
`N`:: Adjust object rotation to terrain.

`P`:: Pick object. You can pick existing object and place it in different place
`CTRL`:: Holding `CTTL` while "picking" will allow selection of multiple items
`C`:: Clone object. Creates object duplicate at the same position.
`Delete`:: Delete selected object.


`Numpad keys` + `pgup` / `pgdown`:: Use for *R/T/Y* if in keyboard layout 1 mode.
`Arrows` and `pgup` / `pgdown`::    Use *R/T/Y* if layout 2.
`Mouse`::   Use `R` `T` `Y`; R/T/Y will stick only to terrain.

==== Track Keys

`Z`:: add selected track to TDB.
`X`:: change new track position. Use before Z.
`F`:: adjust terrain to track. Use after Z. See more: Editing terrain.

==== Terrain Keys

`Z`:: change the terrain 'height-map' painting direction: *+* or *-*
`/`:: Toggle Terrain Collision mode.
`CTRL`:: Auto-Paint Mode


<<<

=== Placing Objects

How to place objects?

1. Select object type you want.
2. Select shape you want.
3. Click `Place New` button or `Q`

[IMAGE]
image::images/reo1.png[]

Click on the ground where you want new object.

[TIP]
 Remember that using `Shift+Q` you can change placement mode between *stick only to terrain* or *stick to everything*.


==== Selecting Objects

You can select all objects using Select Tool. Enable it using:

* `E` key
* Right click -> *Select*
* Edit Menu -> *Select*
* Select button in *F1* Object Tools

Press and hold `CTRL` while selecting to select multiple items

==== Manipulating Objects

* `E` key
* Right click -> *Select*
* Edit Menu -> *Select*
* Use the `R` ket to Rotate, `T` key to Transform, `Y` key to Scale

a. You can select object and move it around using mouse. Use mouse wheel to raise or lower its position. 
b. You can perform advanced translation by pressing `T` and using `4,6,8,2` keys{DOT} to move in X and Z Axis, and `9,3` keys to move in Y axis.
c. You can adjust object rotation by pressing `R` and using `4,6,8,2` keys{DOT}.
d. You can press `Ctrl` to change `RT` step.

[NOTE]
 {DOT} Depending on your keyboard layout, you can use other keys. See: <<editor>>

[TIP] 
  When you rotate an object by use of the Copy/Paste or Transform button, be sure to re-select the object (even though it appears to be selected (blue outline)) by using the 'E' key or the `Select` Button. This is to allow you to regain fine movement control when the `Ctrl` Key is pressed and held with the movement keys.


==== How to duplicate objects?

There are multiple options for object duplication

* Select object and press `Ctrl+C`, find place you want new object and press `Ctrl+V`
* Press `C` to clone object and make duplicate at the same position.
* Press `P` to pick object. Now you can click `Place New` button and place this object in a new location.

==== How to delete objects

* Select the object and press `Delete`.


<<<<

==== Working with Track sections
 
1. Place track
2. Adjust dynamic track properties
3. Save w/no TDB lines
4. Re-select track
5. Press `Z` for TDB 
6. Save




==== Copying Tracks

You can duplicate an existing track by find the one you want, selecting it and then pressing `P`.

Now you can click `Place New` and place this track at another location.

You can also select track and press `Ctrl+C` to copy it and then move to the location where you want add the new track and press `Ctrl+V` to paste it.

[IMAGE]
image::images/ret8.png[]


<<<




==== How to align objects to track

*Stick to track method*

* Click `Stick to track` checkbox.
* Click `Place New` button and place object you want on a track you want to align.

[IMAGE]
image::images/reo2.png[]

*Stick to Target*

1. Enable `Stick To Target`
2. Select "Snapable" target
3. If you want to see snapable points, you can enable `View->Snapable Points`
4. Place new object near snapable point. It will be adjusted to adjacent shape

[IMAGE]
image::images/snap1.png[]

For use when you need to align ANYTHING to track.

* Place a Check in the `Stick to Target` box.
* Any object placed within the distance specified in the *Snappable max radius field* {DOT}, will align to the track.
* Set the size radius smaller to align objects in crowded areas.

{DOT} _This is set in the_ `Target Field Default` _setting is Tracks_

[TIP]
  This sure makes placing track-side equipment, bridges, platforms, gantries easy, even on curve!. Placed items will follow (align to) the track grade. If the alignment is off by 90 degrees,  use the `Rot Y 90` button. The correct gradient will follow the rotation! 

[TIP]
  Signals will automatically align to the track when placed except for direction. Use `Flip`  or `X` to change direction.


==== Copy Rotation

* Select track you want to get the rotation from.
* Click `Copy Rotation` button.
* Select object you want to set the rotation.
* Click `Paste Rotation` button.

[IMAGE]
image::images/reo3.png[]

=== Object Panels

==== Static Objects 



==== Forests 



==== Transfers 



==== Platforms and Sidings 



==== Carspawners



==== Level Crossings


==== Signals

*Linking Signals* 




1. Click 'link' button.
2. Click 'set link' button.
3. Click on track (siding for example) you waypoints

[IMAGE]
image::images/signalLink1.png[]



[TIP]
  Be sure the pointer (cursor) is set to *Stick to Anything mode*. `Shift+Q` toggles the selection.

TSRE's method of linking signals is quite intuitive, but can be daunting for the uninitiated. Here are some lessons learned.

*Easy Junction*

[IMAGE]
image::images/sig1.jpg[]

1. Locate pointer on the track and place the signal. A *red* marker and signal object appear. Flip with `X` if necessary.
2. Click the `Show list` button. 
3. Click the `Link Top Head` checkbox. A check in the box appears and the `Link` button enables.
4. Click the `Link` button. The `Set link` button enables. The fields are blank.
5. Click on the `Set link button.` 
6. Click the switch exit track you want linked. Junction data appears in the *Set Link* fields. 
7. Save 

*Explanation* 

*  Assuming you've placed your signal and know what you want linked, click on the button `Show List` on the left-hand side of the screen. A menu will pop up with all the signal's sub-objects on it. Select what you need. Note that unlike MSTS, you must actually click on the checkbox, rather than either the text or checkbox.
*  When you're ready to link a route, click the `Link` button for that sub-object, which should no longer be greyed-out now that that sub-object has been selected. When you press the `Link` button, the `Set Link` button should now read `Set Link [x]`, with `x` being the sub-object number assigned to it in the `sigcfg file`. That number is not otherwise indicated in the menu, but can be determined by counting from the top starting at 0 for the topmost one. In my case, it reads `Set Link [13]`.
*  When you have done this, click on the track where you want the link set. In my case it will be the diverging route. In the image below, a red arrow indicates where I clicked to set the link. If done right, a set of numbers will appear in the blanks in the SubObjLink info section next to the Set Link button. The two outside numbers will be switch or end-of-track nodes wich will be visible in TSRE. These can be used, especially in tight quarters, to make sure you got the right track linked.

[IMAGE]
image::images/sig2.jpg[]

*Complex Junction*

[IMAGE]
image::images/sig3.jpg[]

Use above steps, but when clicking on links, especially for double slips, these are best practices.
The red circle shows where I would link the through route on this switch. The *green* dotted line shows the *TSection* line for the through route, which will be a good guide to where to link that route. The blue circle shows where a diverging route can be selected on this switch. It works almost without fail, even in very tight spaces.

[IMAGE]
image::images/Link_areas.jpg[]

These guides will work on any switch, not just double slips.


==== Speedposts



==== Pickups 



==== Hazard Objects 



==== Soundsources 



==== Soundregions

<<<

=== Editing Terrain

*How to edit terrain settings?*

Go to *Terrain Tools*. `Menu Tools->Terrain` or `F2`.

* Use `Fixed Height` button and click on tile if you want to reset its height map to fixed value.
* Use `Water level` button and click on tile if you want to set water level for tile.
* Use `Show/H Water` button and click on small tile if you want to show/hide water.
* Use `Show/H Tile` button and click on small tile if you want to show/hide it.

[TIP]
 If you want to show a hidden tile - click on its line.

* If you want to make holes in terrain, use the `Gaps` button and click where you want it. You can use holes for tunnel entrances. If you want to fill the holes, show water first.

[IMAGE]
image::images/rete5.png[]

==== Painting the Terrain Heightmap. 

* Go to *Terrain Tools*. `Menu Tools->Terrain` or `F2`.
* Click `HeightMap` button.
* Click on terrain and paint using mouse.

If you want to switch between making mountains and valleys, press `Z`

[IMAGE]
image::images/rete1.png[]

You can adjust settings:

[IMAGE]
image::images/rete2.png[]

*A: Brush Size*

[IMAGE]
image::images/rete3.png[]

*B: Brush Intensity*

[IMAGE]
image::images/rete4.png[]

*C: Brush fixed height* - it is used if Brush type = Fixed Height. 

*D: Brush type*

* Add simple: current height += brush size {mult} brush intensity
* Add if inside size radius: current height += brush size {mult} brush intensity, but max value is brush size {mult} brush intensity
* Fixed height: set fixed height
* Flatten: make current height closer to average value

*For Fine Adjustments to terrain* 

* `F2` then Click on *HeightMap+* --> *Brush settings:* `Size=1`, `Intensity=1`(this is fine setting) 

* In the View Menu, Check `Terrain Grid` (it's easy when you can see the vertex's to position the cursor.) 

* The `Z` key toggles terrain vertex up/down. It make it VERY handy when sliding cursor around with mouse and left finger on `Z` key. 

Tapping left mouse does it. Sliding and painting with the cursor is really a nice feature, especially with larger brush (cursor) sizes. 

[WARNING]
  Beware of terrain gaps . . . you can loose stuff, it falls though the hole if you dragging... bye bye... it's a long way down. 

[TIP]
  For a very fine adjustment of terrain you can use a track or a road section or just about any object to adjust and/or flatten terrain. However some objects/shapes produce some very strange terrain sculpting. The `Ctrl+Z` key comes in handy here.

<<<

==== Painting Terrain Texture. 

Go to *Terrain Tools*. `Menu Tools->Terrain` or `F2`.

*Putting textures on terrain:*

1. Find some textures and place them in `routeDirectory/terrtex`.
2. Click `Load` button and select your texture from terrtex directory.
3. Click `Put` and click on small tile you want place this texture. 
4. If you want to rotate the texture, click on small tile again.

You can use `Pick` button and pick a texture from the existing small tile instead of loading it from disk.

*Painting terrain textures:*

1. Pick or load texture you want to use as paint, or choose color from color window. 
2. Click `Texture` button if you want to paint using texture.
3. Click `Color` button if you want to paint using color.

[TIP]
  You can't lock small tile to avoid painting it by mistake.

[NOTE]
  Remember that painted textures need a lot of memory and disk space. Use them in important locations only. 

[IMAGE]
image::images/rete6.png[]


==== Auto Tile Generation

[IMAGE]
image::images/autotile1.png[]


1. Select marker file.
2. Select radius in tiles from marker file line.
3. Check if all heightmap files are awailable.
4. Create whole terrain in one click.


[IMAGE]
image::images/autotile2.png[]

[IMAGE]
image::images/autotile3.png[]


<<<

==== Embankments and Cuttings

Here you can adjust embankment settings. Look at this image: 

[IMAGE]
image::images/rete7.png[]

If you want to create embankment or cutting, select the track or road (it must be in TDB) and press `F`.




<<<

[#realistic]
=== Making Realistic Routes Using GEO Data

The Route Editor supports using several methods for making realistic routes easier. You can use:

* Marker Files
* Map Layers
* HGT terrain data import

[NOTE]
 If you are making an imaginary route, you can also skip this section.

==== Marker Files 

Current version of Route Editor supports three different types of marker files formats. It can take input from Traditional Marker Files (MKR), Google Earth Keyhole Markup Language (KML) files and Open Street Map (GPX) files.

1. MKR MSTS file http://msts.steam4me.net/tutorials/mkr_Googlemaps.html
2. KML file https://en.wikipedia.org/wiki/Keyhole_Markup_Language
3. GPX file https://en.wikipedia.org/wiki/GPS_Exchange_Format

[NOTE]
  The original MKR files are the legacy method of placement references used with the MSTS Route Editor.  This is by far the most common method used when creating MSTS routes, however, with TSRE5  everyone should use *KML* or *GPX* methods instead.


===== How to create KML/GPX format files

You can use http://www.gpsvisualizer.com/draw/
This site allows you to draw points and paths on a large number of map layers, including the Google Maps Satellite images. 

Using the *GPS Visualizer* website is very simple. 


Use the Button labeled WPT draw individual waypoints used to define specific locations
Use the Button labeled TRK to draw long segmented paths for roads or tracks.

[IMAGE]
image::images/reg2.png[]

Draw some waypoints and continuos paths

Click on the appropriate button to choose a file type (GPX or KML). Selecting the button will change the file type to be downloaded.  A download link will appear and clicking it will allow you to download the generated file to your computer.

[IMAGE]
image::images/reg4.png[]


Place the downloaded file into the working directory of the route being worked on.

[IMAGE]
image::images/reg5.png[]

* In the *Navi Window*, use the pulldown bar to select your file.
* You can select a file item and then seect the `Jump` button to go to desired position.
* Click menu `View->Markers` to show selected file items. 

[IMAGE]
image::images/reg6.png[]

<<<

==== Map Layers 

Using a _Map layer_ is a better and faster solution than using marker files if you want to create realistic route.

* Go to *Geo Tools*. Menu `Tools->Geo` or press `F3`.
* Click `Load Map` button.
* Find Tile you want to load map layer and click on it.
* In new window click `Load` and wait until map layer download is complete.

You can choose between bright and dark colors.

[IMAGE]
image::images/reg7.png[]

* Close the window.
* Click `Show/H Map` button.
* Find Tile you want to show map layer and click on it.

[IMAGE]
image::images/reg8.png[]

[WARNING] 
    Don't load too many Tile maps at once.

<<<

==== HGT terrain data import 

HGT terrain data import allows you to easily create realistic terrain. 
You need to download the proper HGT files manually. There are many places that HGT files can be downloaded. An example of a site where you can get them from is: http://e4ftl01.cr.usgs.gov/SRTM/SRTMGL1.003/2000.02.11/

[TIP]
  Register here gets you authorized: https://urs.earthdata.nasa.gov/users/new


1. Set *geoPath* in settings to directory where you have your HGT files. _See: <<settings>>_
2. Go to *Geo Tools*. Menu `Tools->Geo` or `F3`.
3. Click `Load Height` button.
4. Find Tile you want to load terrain data and click on it.
5. In new window click `Load` button.

If a proper HGT file doesn't exist, a message box will tell you name of the file you need to download. Close {RE} and download the missing files.

[IMAGE]
image::images/reg9.png[]

* Close the window.
* Enjoy realistic terrain.

[IMAGE]
image::images/reg10.png[]

<<<

==== Using Satellite Images

// I don't know if these even works yet

Using this feature requires Google maps api key. Without it sooner or later you will see grey image instead of satellite view

1. Create Google maps api key.
2. Enable static maps for your key.
3. Place key in `settings.txt`. Example below:

`GoogleMapsKey = Key Goes Here`

To get your own Google Maps API Key, use this link: https://developers.google.com/maps/documentation/javascript/get-api-key

<<<
